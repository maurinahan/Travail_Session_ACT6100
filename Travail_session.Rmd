---
title: "Travail_Session_1_ACT6100"
author: "Maurin AHANHANZO & Gamaliel FATAL"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: pdf_document
---


#### Importation des libraries:

```{r echo=TRUE, warning=FALSE}
#install.packages("choroplethrMaps") # installer le package si vous l'avez pas
#install.packages("choroplethr") # installer le package si vous l'avez pas
library("choroplethr")
library("ggmap")
library("dplyr")
library("tidyverse")
library("FactoMineR")
library("factoextra")
library("ggplot2")
library("corrplot")
```

### Mise en Activité

#### Exploration de la Base de données:


```{r}
### Apercu de la base de données
df <- read.csv("C:/Users/mauac/Desktop/ACT6100/Country-data.csv")
head(df)
```

```{r}
### dimension de la base de données:
dim(df)
```

```{r}
### 
colnames(df)
```

Explication des colonnes de la base de données:

- Country: 
- Child_mort: Décès d'enfants de moins de 5 ans pour 1000 naissances

- Exports : Exportations de biens et services par habitant (en pourcentage du PIB par habitant).

- Health: Dépenses totales de santé par habitant  (en pourcentage du PIB par habitant).

- Imports: Importations de biens et services par habitant (en pourcentage du PIB par habitant).

- Income: Revenu net moyen par personne.

- Inflation: La mesure du taux de croissance annuel du PIB total.

- Life expec : Espérance de vie moyenne à la naissance.

- Total_fer: le nombre d'enfants moyen par femme en âge de procréation.

- GDP: PIB par habitant.

```{r}
#### Vérification si df à des valeurs manquantes:
apply(df, 2, function(x) sum(is.na(x)))
```


```{r}
str(df)
```

```{r}
## Statistiques descriptives :
df_num<-df %>% 
  select_if(is.numeric)
df_num  %>% 
  summary()
```
On constate que nos variables numériques ne sont pas toutes sur la même échelle de valeur. On a gdpp et income qui ont de grandes valeurs comparées aux autres variables.


#### Visualisation:

##### Histogramme de Child_mort:

```{r}
ggplot(df_num, aes(x = child_mort, fill="cornflowerblue")) +
  geom_histogram()+ labs(title="Histogramme de child_mort (mortalité infantile)", 
       subtitle = "number of bins = 20")
```

##### Histogramme de exports:

```{r}
ggplot(df_num, aes(x = exports, fill="cornflowerblue")) +
  geom_histogram()+ labs(title="Histogramme de exports (exportations)", 
       subtitle = "number of bins = 20")
```

##### Histogramme de health:

```{r}
ggplot(df_num, aes(x = health, fill="cornflowerblue")) +
  geom_histogram()+ labs(title="Histogramme de health (Dépense de santé par habitant)", 
       subtitle = "number of bins = 20")
```

##### Histogramme de imports:
```{r}

ggplot(df_num, aes(x = imports, fill="cornflowerblue")) +
  geom_histogram()+ labs(title="Histogramme de imports (importations)", 
       subtitle = "number of bins = 20")
```

##### Histogramme de gdpp:

```{r}
ggplot(df_num, aes(x = gdpp, fill="cornflowerblue")) +
  geom_histogram()+ labs(title="Histogramme de gdpp (PIB)", 
       subtitle = "number of bins = 20")

```

##### Histogramme de total_fer:

```{r}
ggplot(df_num, aes(x = total_fer, fill="cornflowerblue")) +
  geom_histogram()+ labs(title="Histogramme de total_fer", 
       subtitle = "number of bins = 20")

```

##### Histogramme de income:
```{r}
ggplot(df_num, aes(x = income, fill="cornflowerblue")) +
  geom_histogram()+ labs(title="Histogramm de income", 
       subtitle = "number of bins = 20")

```

##### Histogramme de inflation:
```{r}
ggplot(df_num, aes(x = inflation, fill="cornflowerblue")) +
  geom_histogram()+ labs(title="Histogramm de inflation", 
       subtitle = "number of bins = 20")
```
##### Histogramme de life_expec:
```{r}

ggplot(df_num, aes(x = life_expec, fill="cornflowerblue")) +
  geom_histogram()+ labs(title="Histogramme de life_expec", 
       subtitle = "number of bins = 20")
```

#### Visualisation GeoMap:

##### Country vs life_expec:

```{r}
plotdata <- df %>%
  rename(region = country,
         value = life_expec) %>%
  mutate(region = tolower(region)) %>% mutate(region = recode(region,
                          "united states"    = "united states of america",
                          "congo, dem. rep." = "democratic republic of the congo",
                          "congo, rep."      = "republic of congo",
                          "korea, dem. rep." = "south korea",
                          "korea. rep."      = "north korea",
                          "tanzania"         = "united republic of tanzania",
                          "serbia"           = "republic of serbia",
                          "slovak republic"  = "slovakia",
                          "yemen, rep."      = "yemen",
                          "cote d'ivoire"    = "ivory coast",
                          "guinea-bissau"    = "guinea bissau"
                          ))
country_choropleth(plotdata,num_colors=9)+
   scale_fill_brewer(palette="YlOrRd") +
  labs(title = "life_exp par country",
       fill = "life_expec")

# Source: https://rkabacoff.github.io/datavis/GeoMaps.html#dot-density-maps
#Inspiré de ce site
```

##### Country vs income:

```{r}
plotdata <- df %>%
  rename(region = country,
         value = income) %>%
  mutate(region = tolower(region)) %>% mutate(region = recode(region,
                          "united states"    = "united states of america",
                          "congo, dem. rep." = "democratic republic of the congo",
                          "congo, rep."      = "republic of congo",
                          "korea, dem. rep." = "south korea",
                          "korea. rep."      = "north korea",
                          "tanzania"         = "united republic of tanzania",
                          "serbia"           = "republic of serbia",
                          "slovak republic"  = "slovakia",
                          "yemen, rep."      = "yemen",
                          "cote d'ivoire"    = "ivory coast",
                          "guinea-bissau"    = "guinea bissau"
                          ))
country_choropleth(plotdata,num_colors=9)+
   scale_fill_brewer(palette="YlOrRd") +
  labs(title = "income par country",
       fill = "income")

# Source: https://rkabacoff.github.io/datavis/GeoMaps.html#dot-density-maps
#Inspiré de ce site
```

##### Country vs gdpp:

```{r}
plotdata <- df %>%
  rename(region = country,
         value = gdpp) %>%
  mutate(region = tolower(region)) %>% mutate(region = recode(region,
                          "united states"    = "united states of america",
                          "congo, dem. rep." = "democratic republic of the congo",
                          "congo, rep."      = "republic of congo",
                          "korea, dem. rep." = "south korea",
                          "korea. rep."      = "north korea",
                          "tanzania"         = "united republic of tanzania",
                          "serbia"           = "republic of serbia",
                          "slovak republic"  = "slovakia",
                          "yemen, rep."      = "yemen",
                          "cote d'ivoire"    = "ivory coast",
                          "guinea-bissau"    = "guinea bissau"
                          ))
country_choropleth(plotdata,num_colors=9)+
   scale_fill_brewer(palette="YlOrRd") +
  labs(title = "gdpp par country",
       fill = "gdpp")

# Source: https://rkabacoff.github.io/datavis/GeoMaps.html#dot-density-maps
#Inspiré de ce site
```

##### Country vs child_fer:

```{r}
plotdata <- df %>%
  rename(region = country,
         value = child_mort) %>%
  mutate(region = tolower(region)) %>% mutate(region = recode(region,
                          "united states"    = "united states of america",
                          "congo, dem. rep." = "democratic republic of the congo",
                          "congo, rep."      = "republic of congo",
                          "korea, dem. rep." = "south korea",
                          "korea. rep."      = "north korea",
                          "tanzania"         = "united republic of tanzania",
                          "serbia"           = "republic of serbia",
                          "slovak republic"  = "slovakia",
                          "yemen, rep."      = "yemen",
                          "cote d'ivoire"    = "ivory coast",
                          "guinea-bissau"    = "guinea bissau"
                          ))
country_choropleth(plotdata,num_colors=9)+
   scale_fill_brewer(palette="YlOrRd") +
  labs(title = "child_mort par country",
       fill = "child_mort")

# Source: https://rkabacoff.github.io/datavis/GeoMaps.html#dot-density-maps
#Inspiré de ce site
```

##### Country vs total_fer:

```{r}
plotdata <- df %>%
  rename(region = country,
         value = total_fer) %>%
  mutate(region = tolower(region)) %>% mutate(region = recode(region,
                          "united states"    = "united states of america",
                          "congo, dem. rep." = "democratic republic of the congo",
                          "congo, rep."      = "republic of congo",
                          "korea, dem. rep." = "south korea",
                          "korea. rep."      = "north korea",
                          "tanzania"         = "united republic of tanzania",
                          "serbia"           = "republic of serbia",
                          "slovak republic"  = "slovakia",
                          "yemen, rep."      = "yemen",
                          "cote d'ivoire"    = "ivory coast",
                          "guinea-bissau"    = "guinea bissau"
                          ))
country_choropleth(plotdata,num_colors=9)+
   scale_fill_brewer(palette="YlOrRd") +
  labs(title = "total_fer par country",
       fill = "total_fer")

# Source: https://rkabacoff.github.io/datavis/GeoMaps.html#dot-density-maps
#Inspiré de ce site
```

#### Visualisation statistique:

#### Corrélogramme des données numériques:

```{r}
R = cor(df_num)
corrplot(R,type="lower")
```


#### Corrélogramme réduit des données numériques pour extraire les variables dont
#### la corrélation en valeur absolue est supérieure à 0.6:

```{r}
#### Matrice de corrélation.
### Affichons la matrice de correlation pour les variables dont la valeur 
### absolue de la corrélation est supérieure à 0.6

#prepare to drop duplicates and correlations of 1     
R[lower.tri(R,diag=TRUE)] <- NA 
#drop perfect correlations
R[R == 1] <- NA 

sig = 0.6
#turn into a 3-column table
corr <- as.data.frame(as.table(R))
#remove the NA values from above 
corr <- na.omit(corr) 
#select significant values  
corr <- subset(corr, abs(Freq) > sig) 
#sort by highest correlation
corr <- corr[order(-abs(corr$Freq)),] 
#print table
print(corr)
#turn corr back into matrix in order to plot with corrplot
library("reshape2")
mtx_corr <- acast(corr, Var1~Var2, value.var="Freq")
#plot correlations visually
corrplot(mtx_corr, is.corr=FALSE, tl.col="black", na.label=" ")
```

On en ressort sept couples de variables dont la corrélation en valeur absolue entre elles sont supérieures à 0.6. Visualisons les:

```{r}
ggplot(df,aes(x=log(income), y=log(gdpp)))+geom_point()+geom_smooth(method = "lm")

```

On voit que income et gdpp sont fortement correlés positivement. On peut conclure au vu de ce graphique qu'un pays avec un revenu net moyen par personne à tendance à avoir un PIB élevé et vice-versa.


```{r}
ggplot(df,aes(x=child_mort, y=life_expec))+geom_point()+geom_smooth(method=lm)

```

On voit que child_mort et life_expec sont fortement correlés négativement. On peut conclure au vu de ce graphique qu'un pays avec un taux de mortalité infantile élevé à tendance à avoir une espérance de vie moyenne par personne faible et un pays avec espérance de vie moyenne par personne élevée à tendance à avoir une espérance de vie faible.

```{r}
ggplot(df,aes(x=child_mort, y=total_fer))+geom_point()+geom_smooth(method=lm)

```

On voit que child_mort et total_fer sont fortement correlés positivement. On peut conclure qu'au vu de ce graphique qu'un pays avec un taux de mortalité infantile élevé à tendance à avoir un taux de fécondité élevé moyen par femme et vice-versa.

```{r}
ggplot(df,aes(x=life_expec, y=total_fer))+geom_point()+geom_smooth(method=lm)

```
On voit que life_expec et total_fer sont fortement correlés négativement. On peut conclure au vu de ce graphique qu'un pays avec une espérance de vie moyenne par personne élevée à tendance à avoir un taux de fécondité par femme par personne faible.

```{r}
ggplot(df,aes(x=exports, y=imports))+geom_point()+geom_smooth(method=lm)

```
On voit que exports et imports sont fortement liés positivement. On peut conclure qu'au vu de ce graphique qu'un pays qui exporte beaucoup à tendance à importer beaucoup également.

```{r}
ggplot(df,aes(x=log(income), y=life_expec))+geom_point()+geom_smooth(method=lm)
```
On voit que income et life_exp sont corrélés positivement. On peut conclure qu'au vu de ce graphique qu'un pays avec un revenu net moyen par personne élevé à tendance à avoir une espérance de vie moyenne élevée.


```{r}
ggplot(df,aes(x=life_expec, y=log(gdpp)))+geom_point()+geom_smooth(method=lm)
```
On voit que gdpp et life_exp sont corrélés positivement. On peut conclure qu'au vu de ce graphique qu'un pays avec une espérance de vie moyenne élevée à tendance à avoir un PIB élevé. Ceci est pertinent puisque income et gdpp sont fortement correlés entre eux et income est correlés avec life_expec.



```{r}
### Normalisation des données
df_norm <-
  df_num %>%
  mutate_all(scale)
rownames(df_norm)<-df[,1]
head(df_norm)
```

#### ACP sur les données normalisées:

```{r}
# ACP sur les données normalisées
acp<-PCA(df_norm,graph = FALSE)
print(fviz_pca_ind(acp)) 
```

```{r}
print(fviz_pca_var(acp))
```

```{r}
acp$var$coord

### COnclusion: ?
```


```{r}
cos2_obs<-apply(acp$ind$cos2[,1:2],1,sum)
bonne_projection<-cos2_obs[cos2_obs>=0.7] ## prenons 0.7 comme le seuil d'une bonne projection
# Donc le pourcentage d'observations bien projeté est:
(length(bonne_projection)/nrow(df_norm))*100
```
```{r}
cos2_var<-apply(acp$var$cos2[,1:2],1,sum)
bonne_projection<-cos2_var[cos2_var>=0.7] ## prenons 0.7 comme le seuil d'une bonne projection
# Les variables bien projetées sont:
print(bonne_projection)
# Donc le pourcentage de variables bien projeté est:
(length(bonne_projection)/ncol(df_norm))*100
```

```{r}
### Les deux observations qui contribuent le plus aux axes 1 et 2.
## Suggestion: On peut les enlever pour voir.
rownames(acp$ind$contrib)[apply(acp$ind$contrib[,1:2],2,which.max)]

```




```{r}
### Les deux variables qui contribuent le plus aux axes 1 et 2.
rownames(acp$var$contrib)[apply(acp$var$contrib[,1:2],2,which.max)] ## axe 1 // axe 2
contrib_var_ax1_ax2<-apply(acp$var$contrib[,1:2],1,sum)
rownames(acp$var$contrib)[which.max(contrib_var_ax1_ax2)] ## axes 1 et 2
 fviz_contrib(acp, "var", axes = 1)
 fviz_contrib(acp, "var", axes = 2)
 fviz_contrib(acp, "var", axes = c(1,2))
```

```{r}
fviz_pca_biplot(acp, pointsize = "cos2", col.var = "cos2")

```

```{r}
acp$var$coord
```

```{r}
### Interprètations

acp[["eig"]][ , 1]
fviz_eig(acp,addlabels = TRUE)

```

```{r}
fviz_pca_ind(acp, col.ind = "contrib")
```

#### K-means Clustering:

```{r}
### K-means Clustering:
kmeans_res <- kmeans(as.matrix(df_norm), centers = 2, iter.max = 20, nstart = 10)
df_acp<-as.data.frame(acp$ind$coord[,1:2])
rownames(df_acp)<-df[,1]
df_acp["groupe"]<- factor(kmeans_res[["cluster"]])
ggplot(df_acp, aes(x = Dim.1, y = Dim.2, col = groupe, label=rownames(df_acp) )) +
  geom_text()

```

#### Hierarchical clustering:

```{r}
### Hierarchical clustering

hc <- HCPC(df_norm, nb.clust = 2,graph = FALSE)

```
```{r}
fviz_dend(hc)
fviz_cluster(hc, ggtheme = theme_bw())
```

##### Visualisation GeoMap avec nos cluster (Hierarchical clustering) trouvés:

```{r}
df$groupe<-hc$data.clust$clust
plotdata <- df %>%
  rename(region = country,
         value = groupe) %>%
  mutate(region = tolower(region)) %>% mutate(region = recode(region,
                          "united states"    = "united states of america",
                          "congo, dem. rep." = "democratic republic of the congo",
                          "congo, rep."      = "republic of congo",
                          "korea, dem. rep." = "south korea",
                          "korea. rep."      = "north korea",
                          "tanzania"         = "united republic of tanzania",
                          "serbia"           = "republic of serbia",
                          "slovak republic"  = "slovakia",
                          "yemen, rep."      = "yemen",
                          "cote d'ivoire"    = "ivory coast",
                          "guinea-bissau"    = "guinea bissau"
                          ))
country_choropleth(plotdata,num_colors=9)+
   scale_fill_brewer(palette="YlOrRd") +
  labs(title = "groupe par country",
       fill = "groupe")

# Source: https://rkabacoff.github.io/datavis/GeoMaps.html#dot-density-maps
#Inspiré de ce site
```


